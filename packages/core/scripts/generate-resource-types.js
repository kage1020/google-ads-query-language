#!/usr/bin/env node

import { readFileSync, writeFileSync } from 'fs';
import { fileURLToPath } from 'url';
import { dirname, join } from 'path';

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

const schemasDir = join(__dirname, '../src/schemas');
const fieldsV21 = JSON.parse(readFileSync(join(schemasDir, 'fields-v21.json'), 'utf-8'));

// Get all resource names
const resources = Object.keys(fieldsV21);

// Convert snake_case to PascalCase
function toPascalCase(str) {
  return str.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join('');
}

// Generate Field type mapping
const fieldTypes = resources.map(resource => {
  const pascalCase = toPascalCase(resource);
  return `  : TResource extends '${resource}'\n    ? fieldsV19.${pascalCase}Field | fieldsV20.${pascalCase}Field | fieldsV21.${pascalCase}Field`;
}).join('\n');

// Generate Metric type mapping
const metricTypes = resources.map(resource => {
  const pascalCase = toPascalCase(resource);
  return `  : TResource extends '${resource}'\n    ? fieldsV19.${pascalCase}Metric | fieldsV20.${pascalCase}Metric | fieldsV21.${pascalCase}Metric`;
}).join('\n');

// Generate Segment type mapping
const segmentTypes = resources.map(resource => {
  const pascalCase = toPascalCase(resource);
  return `  : TResource extends '${resource}'\n    ? fieldsV19.${pascalCase}Segment | fieldsV20.${pascalCase}Segment | fieldsV21.${pascalCase}Segment`;
}).join('\n');

const output = `// Auto-generated by scripts/generate-resource-types.js
// Do not edit manually

/**
 * Map resource name to its corresponding Field type from google-ads-api
 */
export type ResourceFieldMap<TResource extends string> = TResource extends 'campaign'
  ? fieldsV19.CampaignField | fieldsV20.CampaignField | fieldsV21.CampaignField
${fieldTypes}
    : never;

/**
 * Map resource name to its corresponding Metric type from google-ads-api
 */
export type ResourceMetricMap<TResource extends string> = TResource extends 'campaign'
  ? fieldsV19.CampaignMetric | fieldsV20.CampaignMetric | fieldsV21.CampaignMetric
${metricTypes}
    : MetricV19 | MetricV20 | MetricV21;

/**
 * Map resource name to its corresponding Segment type from google-ads-api
 */
export type ResourceSegmentMap<TResource extends string> = TResource extends 'campaign'
  ? fieldsV19.CampaignSegment | fieldsV20.CampaignSegment | fieldsV21.CampaignSegment
${segmentTypes}
    : SegmentV19 | SegmentV20 | SegmentV21;
`;

console.log(`Generated mappings for ${resources.length} resources`);
console.log(output);

// Optionally write to a file
// writeFileSync(join(__dirname, '../src/generated-resource-types.ts'), output);
